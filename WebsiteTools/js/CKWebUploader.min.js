(function(n){n.CKWebUploader=function(t){function f(n){var t=n/1024;return t>1024?(t/1024).toFixed(2)+" MB":t.toFixed(2)+" KB"}function e(n,t){var r=Math.pow(10,t),i=n*r+.5;return i=parseInt(i,10)/r,i+""}var u={container:"",type:"file",imageOnlyOne:!1,auto:!1,swf:"",server:"",pick:{id:null,multiple:!1,text:"选择文件"},accept:{title:"",extensions:"",mimeTypes:""},thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0,noCompressIfLarger:!1,compressSize:0},showCancleBtn:!0,resize:!1,chunked:!1,chunkSize:4096e3,chunkRetry:2,mergeServer:"MergeFiles.ashx",threads:3,formData:{},fileNumLimit:undefined,fileSizeLimit:undefined,fileSingleSizeLimit:undefined,fileQueued:null,fileDequeued:null,uploadStart:null,uploadProgress:null,uploadSuccess:null,uploadError:null,uploadComplete:null,uploadFinished:null},r,i;t=n.extend({},u,t);t.chunked&&(r=WebUploader.Base.guid(),t.formData=n.extend({},{guid:r},t.formData));i=WebUploader.create({auto:t.auto,swf:t.swf,server:t.server,pick:t.pick,accept:t.accept,thumb:t.thumb,compress:t.compress,resize:t.resize,chunked:t.chunked,chunkSize:t.chunkSize,chunkRetry:t.chunkRetry,mergeServer:t.mergeServer,threads:t.threads,formData:t.formData,fileNumLimit:t.fileNumLimit,fileSizeLimit:t.fileSizeLimit,fileSingleSizeLimit:t.fileSingleSizeLimit,fileQueued:t.fileQueued,fileDequeued:t.fileDequeued,uploadStart:t.uploadStart,uploadProgress:t.uploadProgress,uploadSuccess:t.uploadSuccess,uploadError:t.uploadError,uploadComplete:t.uploadComplete,uploadFinished:t.uploadFinished});i.on("fileQueued",function(r){var e,u,o,s;if(t.fileQueued!=null)t.fileQueued;else if(e=n("#"+t.container),t.type=="file"){u=[];u.push('<div  id="'+r.id+'" class="file-item">');u.push(' <div class="file-info">');u.push('    <span class="file-name">'+r.name+" ("+f(r.size)+')<\/span> <span class="file-percentage"> 0% <\/span>');t.showCancleBtn&&(u.push('   <div class="file-cancel">'),u.push('        <a href="javascript:void(0)"><\/a>'),u.push("   <\/div>"));u.push("  <\/div>");u.push(' <div class="file-progress">');u.push('      <div class="progress-bar"><\/div>');u.push("   <\/div>");u.push(" <\/div>");e.append(u.join(" "));n("#"+r.id).on("click",".file-cancel a",function(){i.removeFile(r,!0);n("#"+r.id).fadeOut(function(){n(this).remove()})})}else{var h=10,c=t.thumb.width-h,l=t.thumb.height-h;t.imageOnlyOne&&(e.html(""),i.reset());u=[];u.push('<div id="'+r.id+'" class="image-item thumbnail">');u.push("<img>");t.showCancleBtn&&u.push('<div class="image-cancel"> <a href="javascript:void(0)"><\/a> <\/div>');u.push('<div class="image-progress"><div class="image-progress-bar"><\/div><\/div>');u.push('<div class="file-name">'+r.name+"<\/div>");u.push("<\/div>");o=n(u.join(" "));s=o.find("img");e.append(o);i.makeThumb(r,function(n,t){if(n){s.replaceWith("<span>不能预览<\/span>");return}s.attr("src",t)},c,l);n("#"+r.id).on("click",".image-cancel a",function(){i.removeFile(r,!0);n("#"+r.id).fadeOut(300,function(){n(this).remove()})})}});i.on("uploadProgress",function(i,r){var u=n("#"+i.id),o=t.type=="file"?u.find(".file-progress .progress-bar"):u.find(".image-progress .image-progress-bar"),f=e(r*100,2);t.type=="file"&&u.find(".file-percentage").html(f+"%");o.css("width",f+"%")});if(t.fileQueued!=null)i.on("fileQueued",t.fileQueued);if(t.fileDequeued!=null)i.on("fileDequeued",t.fileDequeued);if(t.uploadStart!=null)i.on("uploadStart",t.uploadStart);if(t.uploadSuccess!=null)i.on("uploadSuccess",t.uploadSuccess);else i.on("uploadSuccess",function(i,r){t.chunked&&n.post(t.mergeServer,{guid:t.formData.guid,fileExt:r.f_ext,formData:t.formData},function(t){t=n.parseJSON(t);t.hasError&&alert("上传文件成功，合并文件失败！")})});if(t.uploadError!=null)i.on("uploadError",function(){i.stop;t.uploadError});else i.on("uploadError",function(t){i.stop();n("#"+t.id).find(".file-name").addClass("file-error")});if(t.uploadComplete!=null)i.on("uploadComplete",t.uploadComplete);else i.on("uploadComplete",function(t){n("#"+t.id).fadeOut(function(){n(this).remove()})});if(t.uploadComplete!=null)i.on("uploadFinished",function(){t.uploadComplete;i.reset()});else i.on("uploadFinished",function(){i.reset()});return i};n.CKWebUploader.Upload=function(n){var t=n.getFiles().length;t>0&&n.upload()};n.CKWebUploader.Clear=function(t){for(var r=t.getFiles(),i=0;i<r.length;i++)t.removeFile(r[i],!0),n("#"+r[i].id).remove();t.reset()};n.CKWebUploader.Version=function(){return" CKWebUploader Ver:1.7.1604.2215 "};window.CKWebUploader=n.CKWebUploader})(jQuery);
